const deg2rad=t=>t*Math.PI/180,computeDistance=(t,a)=>{const e=deg2rad(a.lat-t.lat),n=deg2rad(a.lon-t.lon),o=Math.pow(Math.sin(e/2),2)+Math.cos(deg2rad(t.lat))*Math.cos(deg2rad(a.lat))*Math.pow(Math.sin(n/2),2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},sort=()=>{navigator.geolocation.getCurrentPosition((t=>{const a=document.querySelectorAll(".cards .card");a.forEach((a=>{const e=computeDistance({lat:parseFloat(a.dataset.lat),lon:parseFloat(a.dataset.lon)},{lat:t.coords.latitude,lon:t.coords.longitude});a.dataset.distance=e;const n=a.querySelector(".extra"),o=document.createElement("p");o.classList.add("distance"),o.textContent=`Distanza: ${e.toFixed(2)} km`,n.append(o)}));const e=Array.prototype.slice.call(a,0);e.sort(((t,a)=>t.dataset.open==a.dataset.open?t.dataset.distance-a.dataset.distance:t.dataset.open-a.dataset.open));const n=document.querySelector(".cards"),o=n.cloneNode(!1);e.forEach((t=>o.appendChild(t))),n.parentNode.replaceChild(o,n)}))};if("geolocation"in navigator){const t=document.getElementsByClassName("centered")[0],a=document.createElement("button");a.id="order",a.classList.add("btn","btn-primary"),a.addEventListener("click",sort),a.innerText="Ordina in base alla distanza",t.insertBefore(a,t.children[1])}
