const deg2rad=t=>t*Math.PI/180,computeDistance=(t,e)=>{const a=deg2rad(e.lat-t.lat),n=deg2rad(e.lon-t.lon),o=Math.pow(Math.sin(a/2),2)+Math.cos(deg2rad(t.lat))*Math.cos(deg2rad(e.lat))*Math.pow(Math.sin(n/2),2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},sort=()=>{const t=document.getElementById("order");t.disabled=!0,t.setAttribute("aria-disabled","true"),navigator.geolocation.getCurrentPosition((t=>{const e=document.querySelectorAll(".cards .card");e.forEach((e=>{const a=computeDistance({lat:parseFloat(e.dataset.lat),lon:parseFloat(e.dataset.lon)},{lat:t.coords.latitude,lon:t.coords.longitude});e.dataset.distance=a;const n=e.querySelector(".extra"),o=document.createElement("p");o.classList.add("distance"),o.textContent=`Distanza: ${a.toFixed(2)} km`,n.append(o)}));const a=Array.prototype.slice.call(e,0);a.sort(((t,e)=>t.dataset.open==e.dataset.open?t.dataset.distance-e.dataset.distance:t.dataset.open-e.dataset.open));const n=document.querySelector(".cards"),o=n.cloneNode(!1);a.forEach((t=>o.appendChild(t))),n.parentNode.replaceChild(o,n)}))};if("geolocation"in navigator){const t=document.getElementById("aule"),e=document.createElement("button");e.id="order",e.classList.add("btn","btn-primary"),e.addEventListener("click",sort),e.innerText="Ordina in base alla distanza",t.children[0].appendChild(e)}
