const deg2rad=t=>t*Math.PI/180,computeDistance=(t,e)=>{const a=deg2rad(e.lat-t.lat),o=deg2rad(e.lon-t.lon),n=Math.pow(Math.sin(a/2),2)+Math.cos(deg2rad(t.lat))*Math.cos(deg2rad(e.lat))*Math.pow(Math.sin(o/2),2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))},sort=()=>{document.getElementById("order").disabled=!0,navigator.geolocation.getCurrentPosition((t=>{const e=document.querySelectorAll(".cards .card");e.forEach((e=>{const a=computeDistance({lat:parseFloat(e.dataset.lat),lon:parseFloat(e.dataset.lon)},{lat:t.coords.latitude,lon:t.coords.longitude});e.dataset.distance=a;const o=e.querySelector(".extra"),n=document.createElement("p");n.classList.add("distance"),n.textContent=`Distanza: ${a.toFixed(2)} km`,o.append(n)}));const a=Array.prototype.slice.call(e,0);a.sort(((t,e)=>t.dataset.open==e.dataset.open?t.dataset.distance-e.dataset.distance:t.dataset.open-e.dataset.open));const o=document.querySelector(".cards"),n=o.cloneNode(!1);a.forEach((t=>n.appendChild(t))),o.parentNode.replaceChild(n,o)}))};if("geolocation"in navigator){const t=document.getElementById("aule"),e=document.createElement("button");e.id="order",e.classList.add("btn","btn-primary"),e.addEventListener("click",sort),e.innerText="Ordina in base alla distanza",t.insertBefore(e,t.children[1])}
